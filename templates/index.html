{% extends "base.html" %}
{% block content %}

<form class="filters" method="get">
  <input name="q" value="{{ q }}" placeholder="Search transcript (EN)..." />
  <input name="phone" value="{{ phone }}" placeholder="Customer phone..." />
  <select name="agent">
    <option value="">All Agents</option>
    {% for a in agents %}
      <option value="{{ a }}" {% if agent and agent==a.lower() %}selected{% endif %}>{{ a }}</option>
    {% endfor %}
  </select>
  <select name="lang">
    <option value="">All Languages</option>
    {% for l in langs %}
      <option value="{{ l }}" {% if lang and lang==l.lower() %}selected{% endif %}>{{ l }}</option>
    {% endfor %}
  </select>
  <select name="status">
    {% for s in statuses %}
      <option value="{{ s }}" {% if status==s %}selected{% endif %}>{{ s }}</option>
    {% endfor %}
    {% if 'answered' not in statuses %}
      <option value="answered" {% if status=='answered' %}selected{% endif %}>answered</option>
    {% endif %}
  </select>
  <button class="btn" type="submit">Filter</button>
</form>

<table>
  <thead>
    <tr>
      <th>Agent</th>
      <th>Customer</th>
      <th>Language</th>
      <th>Duration</th>
      <th>Status</th>
      <th>Score</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
      <tr>
        <td>{{ item.agent_name }}</td>
        <td>{{ item.customer_phone }}</td>
        <td>{{ item.language_detected }}</td>
        <td>{{ item.duration }}</td>
        <td>{{ item.call_status }}</td>
        <td>{{ item.scoring.total }}</td>
        <td>
          <a href="{{ url_for('detail', cid=item._id) }}">View</a> |
          <a href="{{ url_for('report_pdf', cid=item._id) }}">PDF</a>
        </td>
      </tr>
    {% endfor %}
    {% if items|length == 0 %}
      <tr><td colspan="7" style="color:#9fb3d9">No results with current filters.</td></tr>
    {% endif %}
  </tbody>
</table>
{% endblock %}
